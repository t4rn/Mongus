
@{
    ViewBag.Title = "Users";
}

<h2>@ViewBag.Title</h2>

<script>
    angular.module('buttonsDemo1', ['ngMaterial'])


.controller('AppCtrl', function ($scope) {
    $scope.title1 = 'Button';
    $scope.title4 = 'Warn';
    $scope.isDisabled = true;

    $scope.googleUrl = 'http://google.com';

});
</script>

<div ng-controller="AppCtrl" ng-cloak>
    <md-content>

        <section layout="row" layout-sm="column" layout-align="center center" layout-wrap>
            <md-button>{{title1}}</md-button>
            <md-button md-no-ink class="md-primary">Primary (md-noink)</md-button>
            <md-button ng-disabled="true" class="md-primary">Disabled</md-button>
            <md-button class="md-warn">{{title4}}</md-button>
            <div class="label">Flat</div>
        </section>

        <section layout="row" layout-sm="column" layout-align="center center" layout-wrap>
            <md-button class="md-raised">Button</md-button>
            <md-button class="md-raised md-primary">Primary</md-button>
            <md-button ng-disabled="true" class="md-raised md-primary">Disabled</md-button>
            <md-button class="md-raised md-warn">Warn</md-button>
            <div class="label">Raised</div>
        </section>

        <section layout="row" layout-sm="column" layout-align="center center" layout-wrap>
            <md-button class="md-fab" aria-label="Eat cake">
                <md-icon md-svg-src="img/icons/cake.svg"></md-icon>
            </md-button>

            <md-button class="md-fab md-primary" aria-label="Use Android">
                <md-icon md-svg-src="img/icons/android.svg"></md-icon>
            </md-button>

            <md-button class="md-fab" ng-disabled="true" aria-label="Comment">
                <md-icon md-svg-src="img/icons/ic_comment_24px.svg"></md-icon>
            </md-button>

            <md-button class="md-fab md-primary md-hue-2" aria-label="Profile">
                <md-icon md-svg-src="img/icons/ic_people_24px.svg"></md-icon>
            </md-button>

            <md-button class="md-fab md-mini" aria-label="Eat cake">
                <md-icon md-svg-src="img/icons/cake.svg"></md-icon>
            </md-button>

            <md-button class="md-fab md-mini md-primary" aria-label="Use Android">
                <md-icon md-svg-src="img/icons/android.svg" style="color: greenyellow;"></md-icon>
            </md-button>
            <div class="label">FAB</div>
        </section>

        <section layout="row" layout-sm="column" layout-align="center center" layout-wrap>
            <md-button ng-href="{{googleUrl}}" target="_blank">Default Link</md-button>
            <md-button class="md-primary" ng-href="{{googleUrl}}" target="_blank">Primary Link</md-button>

            <md-button>Default Button</md-button>
            <div class="label">Link vs. Button</div>
        </section>

        <section layout="row" layout-sm="column" layout-align="center center" layout-wrap>
            <md-button class="md-primary md-hue-1">Primary Hue 1</md-button>
            <md-button class="md-warn md-raised md-hue-2">Warn Hue 2</md-button>
            <md-button class="md-accent">Accent</md-button>
            <md-button class="md-accent md-raised md-hue-1">Accent Hue 1</md-button>
            <div class="label">Themed</div>
        </section>

        <section layout="row" layout-sm="column" layout-align="center center" layout-wrap>
            <md-button class="md-icon-button md-primary" aria-label="Settings">
                <md-icon md-svg-icon="img/icons/menu.svg"></md-icon>
            </md-button>
            <md-button class="md-icon-button md-accent" aria-label="Favorite">
                <md-icon md-svg-icon="img/icons/favorite.svg"></md-icon>
            </md-button>
            <md-button class="md-icon-button" aria-label="More">
                <md-icon md-svg-icon="img/icons/more_vert.svg"></md-icon>
            </md-button>
            <md-button href="http://google.com"
                       title="Launch Google.com in new window"
                       target="_blank"
                       ng-disabled="true"
                       aria-label="Google.com"
                       class="md-icon-button launch">
                <md-icon md-svg-icon="img/icons/launch.svg"></md-icon>
            </md-button>
            <div class="label">Icon Button</div>
        </section>
    </md-content>
</div>



<button id="btnAddUser" type="button" class="btn btn-success btn">Add User</button>

<div>
    <h3>All users</h3>
    <div id="divResult">
        <table id="table-users" class="table table-hover">
            <tr>
                <th>Id</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Create Date</th>
                <th>Actions</th>
            </tr>
        </table>
    </div>
</div>

<div id="searchDiv">
    <h3>Find user by ID:</h3>
    <form class="form-inline">
        <div class="form-group">
            <input id="userId" type="text" class="form-control" />
            <button id="btnGetUserById" type="button" class="btn btn-primary btn">Get user by ID</button>
        </div>
    </form>

    <div>
        <ul id="ulUserDetails" />
    </div>

    <div id="notFoundDialog" title="User not found">
        <p id="notFoundMessage" />
    </div>
</div>


<div id="dialog-form" title="Create new user">
    <p class="validateTips">All form fields are required.</p>

    <form id="addUserForm">
        <div class="form-group">
            <label for="firstname">First Name</label>
            <input type="text" name="name" id="firstname" class="form-control">
        </div>
        <div class="form-group">
            <label for="lastname">Last Name</label>
            <input type="text" name="name" id="lastname" class="form-control">
        </div>
        <div class="form-group">
            <label for="login">Login</label>
            <input type="text" name="login" id="login" class="form-control">
        </div>
        <!-- Allow form submission with keyboard without duplicating the dialog button -->
        <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
    </form>
</div>



@section Scripts
{
    <script>

        $(function () {

            $.ajax({
                type: "GET",
                url: "/api/users/",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {

                    if (response != null) {
                        // display users in table
                        if ($.isArray(response)) {
                            $.each(response, function (index, response) {
                                appendUserToTable(response);
                            });
                        }
                    }
                },
                failure: function (response) {
                    alert("failure: " + response.responseText);
                },
                error: function (response) {
                    alert("error: " + response.responseText);
                }
            });


            function appendUserToTable(user) {
                var row = "<tr id='tr-" + user.Id + "'>";
                row += "<td>" + user.Id + "</td><td>" + user.FirstName + "</td><td>" + user.LastName + "</td>" + "<td>" + user.CreateDate.toString() + "</td>";
                row += "<td><button id='btnDeleteUser-" + user.Id + "' " + "class='btn btn-danger btn-sm remove-user'>Delete</button></td>";
                row += "</tr>";

                $("#table-users").append(row);
            }

            $("#btnGetUserById").button().on("click", function () {
                var userId = $("#userId").val();
                console.log("userId: " + userId);

                $.ajax({
                    type: "GET",
                    url: "/api/users/" + userId,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data != null) {
                            var str = 'User ' + data.FirstName + ' ' + data.LastName + ' with Id ' + data.Id + ' created on ' + data.CreateDate;
                            $('<li/>', { text: str })
                                .appendTo($('#ulUserDetails'));
                        }
                        else {
                            $("#notFoundDialog").dialog("open");
                            $("#notFoundMessage").html("User with Id " + userId + " not found!");
                        }
                    },
                    failure: function (response) {
                        alert("failure: " + response.responseText);
                    },
                    error: function (response) {
                        alert("error: " + response.responseText);
                    }
                });
            });

            $("#notFoundDialog").dialog(
                {
                    autoOpen: false,
                    show: {
                        effect: "blind",
                        duration: 100
                    },
                    hide: {
                        effect: "explode",
                        duration: 100
                    },
                    buttons: [{
                        text: "OK",
                        "class": 'btn btn-default btn-sm',
                        click: function () {
                            $(this).dialog("close");
                        }
                    }]
                });

            var addUserDialog,
                firstname = $("#firstname"),
                lastname = $("#lastname"),
                login = $("#login");


            function prepareAndAddUser() {
                var valid = true;

                var user = {
                    firstName: firstname.val(),
                    lastname: lastname.val(),
                    login: login.val()
                };

                if (valid) {
                    addUser(user);
                    addUserDialog.dialog("close");
                }
                return valid;
            }

            function addUser(user) {
                $.ajax({
                    type: "POST",
                    url: "/api/users/",
                    data: JSON.stringify(user),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        console.log("POST success: " + JSON.stringify(data));
                        appendUserToTable(data);
                    },
                    failure: function (response) {
                        alert("failure: " + response.responseText);
                    },
                    error: function (response) {
                        alert("error: " + response.responseText);
                    }
                });
            }

            addUserDialog = $("#dialog-form").dialog({
                autoOpen: false,
                height: 400,
                width: 350,
                modal: true,
                buttons: [
                            {
                                text: "Cancel",
                                "class": 'btn btn-default btn-sm',
                                click: function () {
                                    $(this).dialog("close");
                                }
                            },
                            {
                                text: "Create User",
                                "class": 'btn btn-primary btn-sm',
                                click: prepareAndAddUser
                            }],
                close: function () {
                    $("#addUserForm")[0].reset();
                }
            });

            $("#btnAddUser").button().on("click", function () {
                var d = $(this).attr('id');
                addUserDialog.dialog("open");
            });

            $(document).on('click', '.remove-user', function () {
                var btnId = $(this).attr('id');
                var userId = btnId.substring(14);
                console.log("userId for removal: " + userId);

                if (userId != null) {
                    $.when(
                        deleteUser(userId)
                    )
                    .then(function () {
                        $("#tr-" + userId).remove();
                    })
                    .fail(function (data) {
                        console.log('error while deleting: ' + JSON.stringify(data));
                    });

                }
                else {
                    alert("Delete aborted - Id: " + userId);
                }

            });

            function deleteUser(userId) {
                return $.ajax({
                    type: "DELETE",
                    url: "/api/users/" + userId,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        console.log("DELETE succcess: " + JSON.stringify(data));
                    },
                    failure: function (response) {
                        alert("failure: " + response.responseText);
                    },
                    error: function (response) {
                        alert("error: " + response.responseText);
                    }
                })
            }
        });

    </script>
}